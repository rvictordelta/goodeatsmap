<!DOCTYPE HTML>
<html>
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-158104573-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-158104573-1');
    </script>
    <title>Good eats in Chi</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <link href="https://use.fontawesome.com/releases/v5.12.0/css/all.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
        integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
        crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
        integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
        crossorigin=""></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <script src="static/leaflet-sidebar.js"></script>
    <link rel="stylesheet" href="static/leaflet-sidebar.css"/>
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">
    <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #mapid {
            height: 100%;
            width: 100vw;
        }
    </style>
</head>
<body>

    <div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li onclick="show_random_outing()"><a role="tab"><i class="fas fa-dice-three"></i></a></li>
                <li class="disabled"><a role="tab"><i class="fas fa-minus"></i></a></li>
                <li onclick="markers_toggle('Restaurant')"><a role="tab"><i class="fas fa-utensils"></i></a></li>
                <li onclick="markers_toggle('Bar')"><a role="tab"><i class="fas fa-glass-cheers"></i></a></li>
                <li onclick="markers_toggle('Brewery')"><a role="tab"><i class="fas fa-beer"></i></a></li>
                <li onclick="markers_toggle('Breakfast')"><a role="tab"><i class="fas fa-bacon"></i></a></li>
                <li onclick="markers_toggle('Shop')"><a role="tab"><i class="fab fa-diaspora"></i></a></li>
            </ul>

            <ul role="tablist">
                <li><a href="mailto:rvd@dineinchi.com" role="tab"><i class="fa fa-envelope"></i></a></li>
<!--                <li><a href="#settings" role="tab"><i class="fas fa-gear"></i></a></li>-->
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    sidebar-v2
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>

                <p>A responsive sidebar for mapping libraries like <a href="http://leafletjs.com/">Leaflet</a> or <a href="http://openlayers.org/">OpenLayers</a>.</p>

                <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

                <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

                <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

                <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
            </div>

            <div class="sidebar-pane" id="profile">
                <h1 class="sidebar-header">Profile<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>

            <div class="sidebar-pane" id="messages">
                <h1 class="sidebar-header">Messages<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>

            <div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>
        </div>
    </div>

    <div id="mapid" class="sidebar-map"></div>
</body>
<script>
var mymap = L.map('mapid').setView([41.884979, -87.624099], 12);
L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'pk.eyJ1IjoicnZpY3RvcmRlbHRhIiwiYSI6ImNrMTFjOWFwZDBmNjIzYnM3M2tocHhndWUifQ.ruSC3bLrzI-I_ULpxQppIg'
}).addTo(mymap);

var layerLookup = {};
    layerLookup["Bar"] = new L.LayerGroup().addTo(mymap);
    layerLookup["Restaurant"] = new L.LayerGroup().addTo(mymap);
    layerLookup["Shop"] = new L.LayerGroup().addTo(mymap);
    layerLookup["Breakfast"] = new L.LayerGroup().addTo(mymap);
    layerLookup["Late night food"] = new L.LayerGroup().addTo(mymap);
    layerLookup["Entertainment"] = new L.LayerGroup().addTo(mymap);
    layerLookup["Grocery"] = new L.LayerGroup().addTo(mymap);
    layerLookup["Brewery"] = new L.LayerGroup().addTo(mymap);
    layerLookup["Coffee"] = new L.LayerGroup().addTo(mymap);
    layerLookup["Dessert"] = new L.LayerGroup().addTo(mymap);
    layerLookup["Brunch"] = new L.LayerGroup().addTo(mymap);
var core_layers = []
for (var key in layerLookup) {
    core_layers.push(key)
}

// pull in places from places.json file
var places = {}
var markersArray = [] // technical debt
$.ajax({ url: 'places.json', dataType: 'json', async:false,
    success: function( resp ) {
        resp = resp["places"]
        places = resp
        for (var key in resp) {
            if (resp.hasOwnProperty(key)) {
                markersArray.push([resp[key]['lat'], resp[key]['lon'], resp[key]['type'],  "<h1>" + key + "</h1>" + resp[key]['des']])
            }
        }
    },
    error: function( req, status, err ) {
        console.log( 'something went wrong', status, err );
    }
});

// pull in outings from outings.json file
var outings = {}
$.ajax({ url: 'outings.json', dataType: 'json', async:false,
    success: function( resp ) {
        outings = resp["outings"]
    },
    error: function( req, status, err ) {
        console.log( 'something went wrong', status, err );
    }
});

var Icon_blue = L.icon({
    iconUrl: 'images/thin_marker_blue.png',
    iconSize:     [30, 35], // size of the icon
    iconAnchor:   [15, 34], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -25] // point from which the popup should open relative to the iconAnchor
});

var Icon_yell = L.icon({
    iconUrl: 'images/thin_marker_yell.png',
    iconSize:     [30, 35], // size of the icon
    iconAnchor:   [15, 34], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -25] // point from which the popup should open relative to the iconAnchor
});

var Icon_green = L.icon({
    iconUrl: 'images/thin_marker_green.png',
    iconSize:     [30, 35], // size of the icon
    iconAnchor:   [15, 34], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -25] // point from which the popup should open relative to the iconAnchor
});

var Icon_purp = L.icon({
    iconUrl: 'images/thin_marker_purp.png',
    iconSize:     [30, 35], // size of the icon
    iconAnchor:   [15, 34], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -25] // point from which the popup should open relative to the iconAnchor
});

var Icon_red = L.icon({
    iconUrl: 'images/thin_marker_red.png',
    iconSize:     [30, 35], // size of the icon
    iconAnchor:   [15, 34], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -25] // point from which the popup should open relative to the iconAnchor
});

var color_type_lookup = [
    ["Bar",Icon_red],
    ["Restaurant",Icon_blue],
    ["Brewery",Icon_green],
    ["Breakfast",Icon_yell],
    ["Brunch",Icon_yell]
    ]

//assign marker colors to each point in markersArray according to color_type_lookup
for (var i = 0; i < markersArray.length; i++) {
    var icn = Icon_purp
    for (var j = 0; j < color_type_lookup.length; j++){
        if (color_type_lookup[j][0] == markersArray[i][2])
            {icn = color_type_lookup[j][1]}
        };
    marker = new L.marker([markersArray[i][0],markersArray[i][1]], {icon: icn})
    .bindPopup(markersArray[i][3]).addTo(layerLookup[markersArray[i][2]]);
};


var polygon = L.polygon([
    [41.912492, -87.635833],
    [41.912492, -87.634000],
    [41.905000, -87.634000],
    [41.905000, -87.635833]
]).bindPopup("<h1>Old Town</h1>").addTo(mymap);

var polygon = L.polygon([
    [41.949367, -87.658556],
    [41.949447, -87.653406],
    [41.943718, -87.653192],
    [41.943781, -87.656303]
]).bindPopup("<h1>Wrigleyville</h1>").addTo(mymap);

var polygon = L.polygon([
    [41.887175, -87.659708],
    [41.887303, -87.643143],
    [41.882447, -87.644473],
    [41.8828468,-87.6646752]
]).bindPopup("<h1>West Loop</h1>").addTo(mymap);

var polygon = L.polygon([
    [41.903499, -87.681929],
    [41.903867, -87.662982],
    [41.901168, -87.662488],
    [41.901104, -87.681843]
]).bindPopup("<h1>Division / West Town</h1>").addTo(mymap);

var polygon = L.polygon([
    [41.918015, -87.685319],
    [41.918142, -87.673217],
    [41.904984, -87.668196],
    [41.904122, -87.681800]
]).bindPopup("<h1>Wicker Park / Bucktown / Six Corners</h1>").addTo(mymap);

var polygon = L.polygon([
    [41.932766, -87.713772],
    [41.932926, -87.702099],
    [41.917152, -87.685748],
    [41.917472, -87.701670]
]).bindPopup("<h1>Logan Square - ish</h1>").addTo(mymap);

var sidebar = L.control.sidebar('sidebar').addTo(mymap);

var first_view = true

function markers_toggle(layer_name) {
    if (first_view) {
        first_view = false;
        markers_disable("ALL");
        markers_enable(layer_name);
        return ;
        };
    markers_disable_outings()
    if (mymap.hasLayer(layerLookup[layer_name])) {
        markers_disable(layer_name)} else {
        markers_enable(layer_name)};
    };

function markers_disable(layer_name){
    if (layer_name == "Breakfast") {
        mymap.removeLayer(layerLookup["Breakfast"]);
        mymap.removeLayer(layerLookup["Brunch"])
        return ;
        };
    if (layer_name == "ALL") {
        Object.keys(layerLookup).forEach(key=>{
            mymap.removeLayer(layerLookup[key])
            });
        return ;
        };
    if (layer_name == "Shop") {
        mymap.removeLayer(layerLookup["Shop"]);
        mymap.removeLayer(layerLookup["Late night food"]);
        mymap.removeLayer(layerLookup["Entertainment"]);
        mymap.removeLayer(layerLookup["Grocery"]);
        mymap.removeLayer(layerLookup["Coffee"]);
        mymap.removeLayer(layerLookup["Dessert"]);
        return ;
        };
    mymap.removeLayer(layerLookup[layer_name])
    };

function markers_enable(layer_name){
    if (layer_name == "Breakfast") {
        mymap.addLayer(layerLookup["Breakfast"]);
        mymap.addLayer(layerLookup["Brunch"])
        return ;
        };
    if (layer_name == "ALL") {
        Object.keys(layerLookup).forEach(key=>{
            mymap.addLayer(layerLookup[key])
            });
        return ;
        };
    if (layer_name == "Shop") {
        mymap.addLayer(layerLookup["Shop"]);
        mymap.addLayer(layerLookup["Late night food"]);
        mymap.addLayer(layerLookup["Entertainment"]);
        mymap.addLayer(layerLookup["Grocery"]);
        mymap.addLayer(layerLookup["Coffee"]);
        mymap.addLayer(layerLookup["Dessert"]);
        return ;
        };
    mymap.addLayer(layerLookup[layer_name])
    };

// called when general category is toggled with sidebar button click
// disables anything that isn't "core" category (now, just outings)
function markers_disable_outings(){
    for (var key in layerLookup){
            if (!(core_layers.includes(key))){
                mymap.removeLayer(layerLookup[key])
            }
    };
};

// activated on dice button click in sidebar
function show_random_outing() {
    val = Math.floor(Math.random(outings.length))
    outing = outings[val]
    if (first_view) {
        first_view = false;
    }
    markers_disable("ALL")
    if (outing["name"] in layerLookup) {
        mymap.addLayer(layerLookup[outing["name"]])}  // show it
    else {
        // create and then show it
        layerLookup[outing["name"]] = new L.LayerGroup().addTo(mymap);
        for (var i in outing["display_markers"]) {
            place_name = outing["display_markers"][i]
            var icn = Icon_purp
            for (var j = 0; j < color_type_lookup.length; j++){
                if (color_type_lookup[j][0] == places[place_name]['type'])
                    {icn = color_type_lookup[j][1]}
                };
            lat = places[place_name]['lat']
            lon = places[place_name]['lon']
            marker = new L.marker([lat, lon], {icon: icn})
            .bindPopup("<h1>" + place_name + "</h1>" + places[place_name]["des"]).addTo(layerLookup[outing["name"]]);
        };
    lat = places[outing["display_markers"][0]]['lat']
    lon = places[outing["display_markers"][0]]['lon']
    mymap.setView([lat, lon], 15);
    }
}

</script>
</html>